This repo contains example Jenkins Pipelines inside the jobs directory.

The related Pipeline jobs in Jenkins can be generated by JobDSL

# Optional steps for generating the sample jobs by JOB-DSL (jobs dir)
For CloudBees, Job DSL is not remonended because we are using confioguration as code 

1. install the  JobDSL[https://wiki.jenkins.io/display/JENKINS/Job+DSL+Plugi] Plugin
 
2. Create and run a new Pipeline job which points to `Jenkinsfile`  
(http://github-api.kohsuke.org/ is used to scan the GH organisation, see `Seed.groovy` to adjust the values, if required)

3. jobs are generated in the pipeline-example folder 


if you try to run the Jenkinsfiles standalone, you have to fix the path to the yamlFile of some `jobs/Jenkinsfile-*` in this area to your belongings
```
agent {
    kubernetes {
        yamlFile 'yaml/podTemplate.yml'
    }
}
```



## Pre-requirerments: Set up credentials

Setup the following credentials:  (used by some pipelines)

* githubuserssh =GH User and SSH key (Type SSH user and private key)
* githubaccesstoken=GH Access token (Type secret text)
* as well as the dockerhub  credentials for the kaniko  docker build/push job: (see  jobs/Jenkinsfile-docker-build-kaniko.groovy)
for how to add the k8s secret for dockerhub. *Note#: GCR is not implemented yet, docker hub is used in the example pipeline  See instructions below to set up 

## A simple-docker-kaniko-pipeline-example
A simple Dockerfile to build with kaniko
see https://docs.cloudbees.com/docs/cloudbees-core/latest/cloud-admin-guide/using-kaniko#_create_a_new_kubernetes_secret   for further details
### Configure

### rename kubctl-create-secret.sh.default
```
cp -f scripts/kubctl-create-secret.sh.default kubctl-create-secret.sh
```
#### adjust your docker registry values
NORTE: Special characters in password must escape!
```
kubectl create secret docker-registry docker-credentials \
    --docker-username=><USER>  \
    --docker-password=<PASSWORD> \
    --docker-email=<EMAIL>
```
#### create the scercet
```
./kubctl-create-secret.sh
```
#### docker push manually
```
docker login
sudo docker build -t caternberg/hellonode:1.1 .
docker push caternberg/hellonode:1.1
```

